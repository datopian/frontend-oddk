<!-- Form -->
<form action="/search" method="GET">
  <div class="relative mb-5">
    <input id="search-input" type="text" class="border-2 border-solid border-gray-200 py-4 pl-4 pr-20 text-xl outline-none focus:border-secondary w-full" placeholder="{{__('Search datasets')}}" name="q" value="" autofocus>
      <button id="search-button" class="absolute inset-y-0 right-0 w-16 px-4 text-secondary fill-current" type="button" aria-label="Submit">      
        <svg class="w-full h-full"><use xlink:href="#search" /></svg>
      </button>
    </input>
  </div>

  {% set facetNames = {
    organization: 'Organisationer',
    groups: 'Grupper',
    tags: 'Tags',
    res_format: 'Format',
    license_id: 'Licens'
  } %}

  <div class="lg:flex flex-wrap items-center mb-3">
  {% if query.q %}
  {% for qry in query.q.split(' ') %}
  {% if qry.includes(':') == true %}
    <p class="mb-2">
      <span class="font-sm ml-4">{{facetNames[qry.split(':')[0]] + ':'}}</span>
      <span class="bg-secondary font-semibold px-3 text-white rounded-lg mr-3 mb-3 mt-3 lowercase">
          {% for facetId, value in result.search_facets %}
          {% for item in value.items|sort(true, false, 'count') %}
          {% if facetId == qry.split(':')[0] %}
          {% if item.name == qry.split(':')[1] %}
          {{item.display_name}}
          {% endif %}
          {% endif %}
          {% endfor %}
          {% endfor %}
        <a class="pl-2 bold text-primary" href="/search?q={{ query.q | replace(qry, '')}}">
          <svg class="w-3 h-3 inline fill-current"><use xlink:href="#cross" /></svg>
        </a>
      </span>
    </p>
  {% endif %}
  {% endfor %}
  {% endif %}
  </div>
  <div class="lg:flex items-center justify-between">
    <h1 class="text-4xl font-semibold text-primary">{{ result.count or result.found }} {{__('results found')}}</h1>

    {% if result.results %}
      <div>
        <label for="field-order-by">{{__('Order by:')}}</label>
        <select onchange="this.form.submit()" class="bg-white" id="field-order-by" name="sort">
          <option value="score:desc" {% if query.sort == "score:desc" %}selected="selected"{% endif %}>{{__('Relevance')}}</option>
          <option value="title_string:asc" {% if query.sort == "title_string:asc" %}selected="selected"{% endif %}>{{__('Name Ascending')}}</option>
          <option value="title_string:desc" {% if query.sort == "title_string:desc" %}selected="selected"{% endif %}>{{__('Name Descending')}}</option>
          <option value="metadata_modified:desc" {% if query.sort == "metadata_modified:desc" %}selected="selected"{% endif %}>{{__('Last Modified')}}</option>
          <option value="views_recent:desc" {% if query.sort == "views_recent:desc" %}selected="selected"{% endif %}>{{__('Popular')}}</option>
        </select>
      </div>
    {% endif %}
  </div>

</form>
<!-- End of Form -->
